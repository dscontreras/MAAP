classdef DataCollector < Operation
    %DATACOLLECTER Summary of this class goes here
    %   Detailed explanation goes here
    properties(SetAccess = private)
        dataArray;
        output_folder_path;
    end
    
    properties(SetAccess = public)
        outputs = containers.Map('KeyType','char','ValueType','int32');
        param_names;
        inputs;
        valid;
        new;
        error_report_handle;
        queue_index = -1;
        start_check_callback;
    end
    
    properties(SetAccess = public, Constant)
        rx_data = {'-1:all'};
        name = 'DataCollecter';
        insertion_type = 'end';
    end
    
    methods
        function obj = DataCollector(start_check_callback, output_folder_path, error_report_handle)
            obj.valid = true;
            obj.new = true;
            obj.output_folder_path = output_folder_path;
            obj.start_check_callback = start_check_callback;
            if(nargin > 2)
                obj.error_report_handle = error_report_handle;
            end           
        end
        
        function valid = validate(obj, error_tag)
            valid = true;
        end
        
        function startup(obj)
           obj.valid = obj.validate(); 
        end
        
        function execute(obj, argsin)
            if(nargin > 1)
                cached_names = cell(0);
                for i = 1:length(argsin)
                    if(length(cached_names) == 0 || strcmp(argsin{1, i}, cached_names{end}))
                        timestamp = obj.construct_timestamp();
                        filename = [obj.output_folder_path obj.param_names{1, i} '_' timestamp];
                        file = fopen(filename, 'w');
                    end
                    formatspec = '%s:\n';
                    fprintf(file, formatspec, obj.param_names{2, i});
                    numformatspec = '%5.2u';
                    fprintf(file, numformatspec, argsin{i});
                end
            end
        end
        
        function timestamp = construct_timestamp(obj)
            timestamp = strjoin(clock, '_');
        end
    end
    
end

